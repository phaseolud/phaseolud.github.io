---
title: "Faster Calculations for Nuclear Fusion with Machine Learning"
description: "In this blog post we discuss what tomographic inversions are, and in what fields we might find them. Solving inverse problems is difficult, so we work through examples, and use an interactive tool to visualize the inversion problem."
pubDate: "19 Oct 2022"
layout: "../../layouts/BlogPost.astro"
---

import InfoBlock from "../../components/InfoBlock.astro";
import Todo from "../../components/Todo.astro";
import DrawPoloidalCamera from "../../components/blog/machine-learning-reconstruction/DrawPoloidalCamera.tsx";

_This target audience of this blogpost is anyone who is interested in the use of camera images in fusion reactors. The post consists of a general introduction, including an interactive example to better understand the challenges and the problem. Next, an example that is much simpler, but captures the essence, is presented; I encourage you to grab a pen and paper and work along. We use high school mathematics in this post, but even without I would recommend trying to read it. If you are already in fusion but would like to understand the camera system in TCV fast, I would start from [here](#interactiveExample)._

Electricity is very important in our society. Ideally, all the energy comes from sustainable sources, but that is unfortunately not yet the case. One potential future sustainable energy source is nuclear fusion, but there are still some challenges to solve before it can be used effectively.

The temperature in a nuclear fusion reactor can be very hot, around 150 million degrees Celsius, ten times hotter than the sun. To generate the heat and energy, we burn a fuel. In this process of burning fuel, ashes are also created. These ashes must be removed because they do not burn that well. However, we need to be careful when removing the ashes, because some heat can go with the ashes. The walls of the reactor can not handle a heat that is too high. Therefore, we need to actively control the amount of heat that reaches the wall.

But for good control we also need measurements. For example, a thermostat can not keep the room at 18 ¬∞C, if it does not know what the temperature is in the room. Another example: a self-driving car will never be able to drive safely if it cannot see the environment. The car needs cameras to know what is happening in the outside world. In the same way, we have cameras looking inside the reactor to know what is happening. However, a challenge is that the camera do not exactly measure what we want to know; they are measuring a _projection_. Two examples of projections can be seen in the images below. The dark blue block and line have light blue 'shadows', and these shadows are the projections of the block/line.

<div class="flex flex-col md:flex-row">
  <img
    class="object-contain md:w-1/2 w-full"
    src="/blogdata/machine-learning-reconstruction/projection-1.svg"
  />
  <img
    class="object-contain md:w-1/2 w-full"
    src="/blogdata/machine-learning-reconstruction/projection-2.svg"
  />
</div>

## Understanding Projections in a Fusion Reactor

The fusion reactor we use is doughnut shaped. The image below shows a drawing of the fusion reactor on the left, with on the inside the blue/yellow being the burning fuel. The black box in the left image indicates where the camera looks. On the right we can see what the camera sees. The blue light turns around the centre inside the reactor.

<div class="flex flex-col md:flex-row">
  <img class="object-contain w-full" src="/blogdata/machine-learning-reconstruction/drawing_test1.svg" />
</div>
<p class="text-xs text-left mt-0">
  The left image is adapted from
  https://www.deepmind.com/blog/accelerating-fusion-science-through-learned-plasma-control
</p>
We will now look at another example, but now we look directly at the cross-section, and not at the whole
reactor any more. The image below on the left shows an example cross-section emitting light. The image on the
right shows us again what that would look like with the camera.

<div class="flex flex-row justify-between items-start content-start max-w-full">
  <img
    class="object-contain w-5/12 md:w-auto md:max-h-[384px]"
    src="/blogdata/machine-learning-reconstruction/example_pol.png"
  />
  <img
    class="object-contain w-7/12 md:w-auto md:max-h-[384px]"
    src="/blogdata/machine-learning-reconstruction/example_camera_image.png"
  />
</div>

<div id="interactiveExample"></div>
To even get more insight into how the camera images are created from the cross-sections, the following
interactive example allows you to draw light in the cross-section, and the camera image is automatically
calculated from that. I encourage you to play around and find out how the location of the light in the
cross-section influences the camera image. Try to understand how the cross-section turns around to make a
camera image! You can draw by clicking and dragging with your mouse. Lines drawn in the bottom left region are
most visible in the camera image, because the camera is directly looking at this light. However, if you draw
lines in the upper half or more on the right, you can see that it is much more difficult to see the original
shape.

<DrawPoloidalCamera client:load />

As we can see, the calculation of the camera image given the cross-section happens quickly. However, transforming the camera image back to a cross-section is difficult and pretty slow. In this blog post we will find out why it is difficult and slow, and gain insight how we can speed them up with machine learning.

## From Camera Images in a Reactor to Buying Fruit, and Back

To understand why calculating the cross-section given a camera image is slow, we will tackle a much smaller and comprehensible problem, but with the same essence!

Let's take the scenario that you are selling fruit and vegetables at the farmer's market and that the price of an apple is ‚Ç¨0.50 and the price of a banana ‚Ç¨1. Two customers arrive, and they order the following:

| Customer | Number of Apples | Number of Bananas |
| -------- | ---------------- | ----------------- |
| Xavier   | 2                | 3                 |
| Yenifer  | 1                | 2                 |

Calculating the total price for both Xavier and Yenifer is pretty straightforward:

| Customer | Cost Apples             | Cost Bananas      | Total Cost |
| -------- | ----------------------- | ----------------- | ---------- |
| Xavier   | 2 $\cdot$ ‚Ç¨0.50 = ‚Ç¨1    | 3 $\cdot$ ‚Ç¨1 = ‚Ç¨3 | ‚Ç¨3         |
| Yenifer  | 1 $\cdot$ ‚Ç¨0.50 = ‚Ç¨0.50 | 2 $\cdot$ ‚Ç¨1 = ‚Ç¨2 | ‚Ç¨2.50      |

Okay, bad news! You just found out that there is a new competitor on the market, who is also selling apples and bananas. And you have seen that both your loyal customers Xavier and Yenifer are also going to the new competitor. You would like to know for which price she sells her apples and bananas, but asking is not really possible. However, you can find out how much Xavier and Yenifer pay in total using your binoculars. You saw that Xavier paid ‚Ç¨8 and Yenifer paid ‚Ç¨5. Fortunately, both Xavier and Yenifer **always** buy the same amounts of apples and bananas. We will try to calculate the prices of this new competitor from the given information. To get started we use the following symbols as abbreviations; and make the text look a bit less mathematical:

| Symbol | Meaning                  |
| ------ | ------------------------ |
| üçé     | Price of a single apple  |
| üçå     | Price of a single banana |

We know that Xavier always buys 2 apples and 3 bananas and that Yenifer always buys 1 apple and 2 bananas. If we combine that with the total prices of ‚Ç¨8 for Xavier and ‚Ç¨5 for Yenifer we find:

$$
\begin{align*}
  2 \cdot üçé + 3 \cdot üçå &= ‚Ç¨8 &\text{(Xavier)} \\
  1 \cdot üçé + 2 \cdot üçå &= ‚Ç¨5 &\text{(Yenifer)}
\end{align*}
$$

Finding the price of the apples and bananas is a bit difficult. What we can do to get started is taking a look at Yenifer. We can express the price of an apple in terms of bananas for her:

$$
\begin{gather*}
  1 \cdotüçé+ 2 \cdotüçå= ‚Ç¨5 &\text{(Yenifer)} \\
  \impliesüçé =  ‚Ç¨5 - 2 \cdotüçå
\end{gather*}
$$

Okay, so we know that the price of an apple is the total price for Yenifer (‚Ç¨5) minus 2 times the price of a banana. But now we know the price of an apple in terms of bananas. So, we can plug this into the price calculation of Xavier:

$$
\begin{align*}
 2 \cdot \overbrace{‚Ç¨5 - 2 \cdotüçå}^{üçé\  \text{from Yenifer}} + 3 \cdotüçå&= ‚Ç¨8 &\text{(Xavier)} \\
 = ‚Ç¨10 - 4 \cdotüçå+ 3 \cdotüçå&= ‚Ç¨8
\end{align*}
$$

We now have something pretty cool: in this last expression we only have euros and the price of bananas, which means we can calculate the price of a banana!

$$
\begin{align*}
  ‚Ç¨10 - 4 \cdotüçå+ 3 \cdotüçå&= ‚Ç¨8 \implies \\
  -1 \cdotüçå&= - ‚Ç¨2 \implies \\
üçå&= ‚Ç¨2
\end{align*}
$$

Now we can use the price of a banana in the total price calculation of Yenifer (or Xavier) to calculate the price of an apple:

$$
\begin{align*}
1 \cdotüçé+ 2 \cdot \overbrace{‚Ç¨2}^üçå &= ‚Ç¨5 \implies \\
1 \cdotüçé+ ‚Ç¨4 &= ‚Ç¨5 \implies \\üçé&= ‚Ç¨1
\end{align*}
$$

Phew, that was some work, but now we know that the prices of our competitor are quite a bit higher than ours with a banana costing ‚Ç¨2 and an apple costing ‚Ç¨1. We have also seen that if we know to price of a banana and apple, we can pretty easily calculate the total price. However, if we only have the total price, it quite a bit more effort to calculate the price of the fruits. The same holds for our camera images: given the cross-section we can easily calculate the camera image, but going from a camera image to a cross-section is much more difficult.

## Machine Learning for Faster Calculations

The next weeks you are at the market again, but now there are even more competitors. Because you can now calculate their prices by knowing their total price, you have written all the total prices Xavier and Yenifer paid for each competitor. We abbreviate total price as TP and competitor as C.:

| Customer | TP C.1 | TP C.2 | TP C.3 | TP C.4 |
| -------- | ------ | ------ | ------ | ------ |
| Xavier   | ‚Ç¨8     | ‚Ç¨10    | ‚Ç¨12    | ‚Ç¨14    |
| Yenifer  | ‚Ç¨5     | ‚Ç¨6     | ‚Ç¨7     | ‚Ç¨8     |

It would be quite some work to find all their sell prices (and those of future competitors), maybe we can find some structure in answers. We ask our neighbour who really likes doing calculations to work out the prices of the different competitors, but he only has time for competitor 2 and 3 (1 we already did ourselves). We write it again down in a table with Xavier and Yenifer abbreviated as X and Y:

<table>
  <thead>
    <tr>
      <th>Fruit</th>
      <th>C. 1</th>
      <th>C. 2</th>
      <th>C. 3</th>
      <th>C. 4</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Customer</td>
      <td>
        <table>
          <tr style="border-bottom: 0px;">
            <td>X</td>
            <td>Y</td>
          </tr>
        </table>
      </td>
      <td>
        <table>
          <tr style="border-bottom: 0px;">
            <td>X</td>
            <td>Y</td>
          </tr>
        </table>
      </td>
      <td>
        <table>
          <tr style="border-bottom: 0px;">
            <td>X</td>
            <td>Y</td>
          </tr>
        </table>
      </td>
      <td>
        <table>
          <tr style="border-bottom: 0px;">
            <td>X</td>
            <td>Y</td>
          </tr>
        </table>
      </td>
    </tr>
    <tr style="border-bottom: 1px solid black;">
      <td>Total Price</td>
      <td>
        <table>
          <tr style="border-bottom: 0px;">
            <td>‚Ç¨8</td>
            <td>‚Ç¨5</td>
          </tr>
        </table>
      </td>
      <td>
        <table>
          <tr style="border-bottom: 0px;">
            <td>‚Ç¨10</td>
            <td>‚Ç¨6</td>
          </tr>
        </table>
      </td>
      <td>
        <table>
          <tr style="border-bottom: 0px;">
            <td>‚Ç¨12</td>
            <td>‚Ç¨7</td>
          </tr>
        </table>
      </td>
      <td>
        <table>
          <tr style="border-bottom: 0px;">
            <td>‚Ç¨14</td>
            <td>‚Ç¨8</td>
          </tr>
        </table>
      </td>
    </tr>
    <tr>
      <td>Price Apple</td>
      <td>‚Ç¨1</td>
      <td>‚Ç¨2</td>
      <td>‚Ç¨3</td>
      <td style="color: #ee6c4dff;">‚Ç¨?</td>
    </tr>
    <tr>
      <td>Price Banana</td>
      <td>‚Ç¨2</td>
      <td>‚Ç¨2</td>
      <td>‚Ç¨2</td>
      <td style="color: #ee6c4dff">‚Ç¨?</td>
    </tr>
  </tbody>
</table>

If we look at this table we can see a pattern: for every total price increase of ‚Ç¨2 for Xavier and ‚Ç¨1 euro for Yenifer, the price of an apple increases by ‚Ç¨1, whereas the price of a banana stays the same. This means we can find the prices of competitor 4 from this pattern: using this found pattern we find that the apple costs ‚Ç¨4 and the banana ‚Ç¨2.

Finding a pattern is something that computers, just like humans, are good at. The learning of patterns from data by a computer is often called machine learning. By using patterns, calculations can become much faster. This can also be applied to the original problem: speeding up the calculations for the camera inside a fusion reactor, which contributes to a safer and more performant reactor, and hopefully in the end a sustainable source of energy.

<Todo>maybe let the NN run in the browser</Todo>
